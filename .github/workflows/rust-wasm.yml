name: build

on: [push]

jobs:
  check:
    name: Rust project
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: "10"
      # - name: Install latest nightly
      #   uses: actions-rs/toolchain@v1
      #   with:
      #     toolchain: nightly
      #     override: true
      #     components: rustfmt, clippy

      # `cargo check` command here will use installed `nightly`
      # as it is set as an "override" for current directory

      # - name: Run cargo check
      #   uses: actions-rs/cargo@v1
      #   with:
      #     command: check

      # - uses: actions/checkout@v2

      - name: Install
        run: curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh -s -- -f

      - run: rustup target add wasm32-unknown-unknown
      # - run: curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
      # - run: source ~/.nvm/nvm.sh
      # - run: nvm install 10

      - run: mkdir -p docs
      - run: rm -rf ./docs/*
      - run: wasm-pack build
      - run: cd www && npm install
      - run: npm run build
      - run: mv ./dist/* ../docs

      # - run: cargo test
      # - run: wasm-pack test --headless --chrome
      # - run: wasm-pack test --headless --firefox
